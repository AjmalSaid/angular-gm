/**
 * AngularGM - Google Maps Directives for AngularJS
 * @version v0.0.1 - 2013-03-23
 * @link http://dylanfprice.github.com/angular-gm
 * @author Dylan Price <the.dylan.price@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";(function(){angular.module("googleMaps",[]).value("googleMapsDefaults",{mapOptions:{zoom:8,center:new google.maps.LatLng(46,-120),mapTypeId:google.maps.MapTypeId.ROADMAP}})})(),function(){angular.module("googleMaps").directive("gmMap",["$timeout","googleMapControllerFactory",function(t,n){function e(n,e,a,o){if(angular.isDefined(n.gmCenter)||(n.center={}),angular.isDefined(n.gmBounds)||(n.bounds={}),!angular.isDefined(n.gmMapId))throw"googleMap must have non-empty gmMapId attribute";var r=!1,i=!1,g=!1;a.hasOwnProperty("gmCenter")&&(r=!0),a.hasOwnProperty("gmZoom")&&(i=!0),a.hasOwnProperty("gmBounds")&&(g=!0);var s=function(){t(function(){(r||i||g)&&n.$apply(function(){if(r&&(n.gmCenter=o.center),i&&(n.gmZoom=o.zoom),g){var t=o.bounds;t&&(n.gmBounds=t)}})})};o.addMapListener("drag",s),o.addMapListener("zoom_changed",s),o.addMapListener("center_changed",s),o.addMapListener("bounds_changed",s),r&&n.$watch("gmCenter",function(t,n){var e=t!==n;if(e&&!o.dragging){var a=t;a&&(o.center=a)}},!0),i&&n.$watch("gmZoom",function(t,n){var e=null!=t&&!isNaN(t);e&&t!==n&&(o.zoom=t)}),g&&n.$watch("gmBounds",function(t,n){var e=t!==n;if(e&&!o.dragging){var a=t;a&&(o.bounds=a)}})}return{restrict:"AE",priority:100,template:'<div><div id="" style="width:100%;height:100%;"></div><div ng-transclude></div></div>',transclude:!0,replace:!0,scope:{gmCenter:"=",gmZoom:"=",gmBounds:"=",gmMapOptions:"&",gmMapId:"&"},controller:n.MapController,link:e}}])}(),function(){angular.module("googleMaps").directive("gmMarkers",["$log","$parse","$timeout","googleMapsUtils",function(t,n,e,a){function o(t,a,o,i){if(!("gmObjects"in o))throw"gmObjects attribute required";if(!("gmGetLatLng"in o))throw"gmGetLatLng attribute required";var g={};angular.forEach(o,function(t,e){if(0===e.lastIndexOf("gmOn",0)){var a=angular.lowercase(e.substring(4)),o=n(t);g[a]=o}});var s=function(n){var a=t.gmMarkerOptions(),o={};angular.forEach(n,function(n){var s=t.gmGetLatLng({object:n}),l=r(s);if(null!=l){var u=l.toUrlValue(i.precision);if(o[u]=n,!i.hasMarker(s.lat,s.lng)){var p={};angular.extend(p,a,{position:l}),i.addMarker(p);var c=i.getMarker(s.lat,s.lng);angular.forEach(g,function(a,o){i.addListener(c,o,function(){e(function(){a(t.$parent.$parent,{object:n,marker:c})})})})}}});var s=[];i.forEachMarker(function(t){var n=t.getPosition(),e=n.toUrlValue(i.precision);e in o||s.push(t)}),angular.forEach(s,function(t){var n=t.getPosition();i.removeMarker(n.lat(),n.lng())})};t.$watch("gmObjects().length",function(n,e){null!=n&&n!==e&&s(t.gmObjects())}),t.$watch("gmObjects()",function(n,e){null!=n&&n!==e&&s(t.gmObjects())}),t.$watch("gmEvent()",function(t,n){if(null!=t&&t!==n){var a=t.event,o=t.location,r=i.getMarker(o.lat(),o.lng());null!=r&&e(angular.bind(this,i.trigger,r,a))}}),e(angular.bind(null,s,t.gmObjects()))}a.latLngEqual;var r=a.objToLatLng;return{restrict:"AE",priority:100,scope:{gmObjects:"&",gmGetLatLng:"&",gmMarkerOptions:"&",gmEvent:"&"},require:"^gmMap",link:o}}])}(),function(){angular.module("googleMaps").factory("googleMapControllerFactory",["googleMapsUtils","googleMapsDefaults","googleMapsContainer",function(t,n,e){var a=t.latLngEqual,o=t.boundsEqual,r=t.hasNaN,i=n,g=e,s=function(t,n){var e=t.gmMapId();if(!e)throw"googleMap must have non-empty gmMapId attribute";var l=n.find("[id]");l.attr("id",e);var u=this._getConfig(t,i);this._map=this._createMap(e,l,u,g),this._markers={},this.dragging=!1,Object.defineProperties(this,{precision:{value:s.precision,writeable:!1},center:{configurable:!0,get:function(){return this._map.getCenter()},set:function(t){if(r(t))throw"center contains null or NaN";var n=!a(this.center,t);n&&this._map.panTo(t)}},zoom:{configurable:!0,get:function(){return this._map.getZoom()},set:function(t){if(null==t||isNaN(t))throw"zoom was null or NaN";var n=this.zoom!==t;n&&this._map.setZoom(t)}},bounds:{configurable:!0,get:function(){return this._map.getBounds()},set:function(t){var n=!r(t.getSouthWest())&&!r(t.getNorthEast());if(!n)throw"bounds contains null or NaN";var e=!o(this.bounds,t);e&&this._map.fitBounds(t)}}}),this._initDragListeners(),t.$on("$destroy",angular.bind(this,this._destroy,e))};return s.precision=3,s.prototype._getConfig=function(t,n){var e=n.mapOptions,a={};return angular.extend(a,e,t.gmMapOptions()),a},s.prototype._createMap=function(t,n,e,a){var o=a.getMap(t);if(o)throw"A map with id "+t+" already exists. You must use"+" different ids for each instance of the googleMap directive.";return o=new google.maps.Map(n[0],e),a.addMap(t,o),o},s.prototype._initDragListeners=function(){var t=this;this.addMapListener("dragstart",function(){t.dragging=!0}),this.addMapListener("idle",function(){t.dragging=!1}),this.addMapListener("drag",function(){t.dragging=!0})},s.prototype._destroy=function(t){g.removeMap(t)},s.prototype.addMapListener=function(t,n){google.maps.event.addListener(this._map,t,n)},s.prototype.addMapListenerOnce=function(t,n){google.maps.event.addListenerOnce(this._map,t,n)},s.prototype.addListener=function(t,n,e){google.maps.event.addListener(t,n,e)},s.prototype.addListenerOnce=function(t,n,e){google.maps.event.addListenerOnce(t,n,e)},s.prototype.mapTrigger=function(t){google.maps.event.trigger(this._map,t)},s.prototype.trigger=function(t,n){google.maps.event.trigger(t,n)},s.prototype.addMarker=function(t){var n={};if(angular.extend(n,t),!(n.position instanceof google.maps.LatLng))throw"markerOptions did not contain a position";var e=new google.maps.Marker(n),a=e.getPosition();if(this.hasMarker(a.lat(),a.lng()))return!1;var o=a.toUrlValue(this.precision);return this._markers[o]=e,e.setMap(this._map),!0},s.prototype.hasMarker=function(t,n){return this.getMarker(t,n)instanceof google.maps.Marker},s.prototype.getMarker=function(t,n){if(null==t||null==n)throw"lat or lng was null";var e=new google.maps.LatLng(t,n),a=e.toUrlValue(this.precision);return a in this._markers?this._markers[a]:null},s.prototype.removeMarker=function(t,n){if(null==t||null==n)throw"lat or lng was null";var e=new google.maps.LatLng(t,n),a=!1,o=e.toUrlValue(this.precision),r=this._markers[o];return r&&(r.setMap(null),a=!0),this._markers[o]=null,delete this._markers[o],a},s.prototype.fitToMarkers=function(){var t=new google.maps.LatLngBounds;this.forEachMarker(function(n){t.extend(n.getPosition())}),this.bounds=t},s.prototype.forEachMarker=function(t){if(null==t)throw"fn was null or undefined";angular.forEach(this._markers,function(n){null!=n&&t(n)})},{MapController:s}}])}(),function(){angular.module("googleMaps").factory("googleMapsContainer",["$q",function(t){function n(t,n){if(!(n instanceof google.maps.Map))throw"map not a google.maps.Map: "+n;if(t in i)throw"already contain map with id "+t;i[t]=n,t in g&&g[t].resolve(n)}function e(t){return i[t]}function a(n){var e=g[n]||t.defer();return g[n]=e,e.promise}function o(t){t in i&&delete i[t],t in g&&delete g[t]}function r(){i={},g={}}var i={},g={};return{addMap:n,getMap:e,getMapPromise:a,removeMap:o,clear:r}}])}(),function(){angular.module("googleMaps").factory("googleMapsUtils",[function(){function t(t,n){return 1e-6>Math.abs(t-n)}function n(n,e){return n instanceof google.maps.LatLng&&e instanceof google.maps.LatLng?t(n.lat(),e.lat())&&t(n.lng(),e.lng()):!1}function e(t,e){if(!(t instanceof google.maps.LatLngBounds&&e instanceof google.maps.LatLngBounds))return!1;var a=t.getSouthWest(),o=e.getSouthWest(),r=t.getNorthEast(),i=e.getNorthEast();return n(a,o)&&n(r,i)}function a(t){if(!(t instanceof google.maps.LatLng))throw"latLng not a google.maps.LatLng";return{lat:t.lat(),lng:t.lng()}}function o(t){if(null!=t){var n=t.lat,e=t.lng,a=!(null==n||null==e||isNaN(n)||isNaN(e));if(a)return new google.maps.LatLng(n,e)}return null}function r(t){if(!(t instanceof google.maps.LatLng))throw"latLng must be a google.maps.LatLng";var n=null==t.lat()||null==t.lng(),e=isNaN(t.lat())||isNaN(t.lng());return n||e}return{latLngEqual:n,boundsEqual:e,latLngToObj:a,objToLatLng:o,hasNaN:r}}])}();